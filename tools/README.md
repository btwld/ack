# Ack Development Tools

This directory contains internal development tools and documentation for the Ack library, focusing on JSON Schema validation.

## üìÅ Directory Structure

- `jsonschema-validator.js` - JSON Schema Draft-7 validation tool
- `docs/` - **Internal development documentation** (not published)
- `test-fixtures/` - Test data and configurations

## üìö Documentation

See the main project documentation for development workflows.

## Setup

Install Node.js dependencies:

```bash
cd tools
npm install
```

## JSON Schema Validator

The `jsonschema-validator.js` script validates that Ack-generated JSON schemas are valid JSON Schema Draft-7 specifications using industry-standard JSON Schema validation.

### Usage

#### Single Schema Validation

Validate a single JSON schema specification:

```bash
node jsonschema-validator.js validate-schema --schema schema.json --output results.json
```

#### Batch Schema Validation

Run multiple schema validation tests from a configuration file:

```bash
node jsonschema-validator.js validate-batch --input batch-config.json --output results.json
```

#### Legacy Mode

For backward compatibility:

```bash
node jsonschema-validator.js schema.json [output.json]
```

### Test Fixtures

The `test-fixtures/` directory contains:

- `schemas/` - Sample JSON schemas generated by Ack
- `data/valid/` - Valid test data that should pass validation
- `data/invalid/` - Invalid test data that should fail validation
- `batch-config.json` - Configuration for batch testing

### Integration with Dart Tests

The validator can be called from Dart tests to create golden file tests that ensure Ack's validation behavior matches JSON Schema validation standards.

Example Dart test:

```dart
test('JSON Schema compatibility for user schema', () async {
  // Generate JSON schema from Ack schema
  final ackSchema = Ack.object({
    'name': Ack.string.minLength(2),
    'email': Ack.string.email(),
  }, required: ['name', 'email']);
  
  final jsonSchema = JsonSchemaConverter(schema: ackSchema).toSchema();
  
  // Write schema to temp file
  final schemaFile = File('temp/user-schema.json');
  await schemaFile.writeAsString(jsonEncode(jsonSchema));
  
  // Run JSON Schema validation
  final result = await Process.run('node', [
    'tools/jsonschema-validator.js',
    'batch',
    '--input', 'tools/test-fixtures/batch-config.json',
    '--output', 'temp/jsonschema-results.json'
  ]);

  expect(result.exitCode, equals(0));

  // Compare with golden file
  final results = jsonDecode(await File('temp/jsonschema-results.json').readAsString());
  await expectLater(results, matchesGoldenFile('jsonschema-validation-results.golden'));
});
```

### Output Format

The validator outputs structured JSON results:

```json
{
  "timestamp": "2024-01-01T00:00:00.000Z",
  "tests": [
    {
      "name": "user-schema-validation",
      "schemaPath": "schemas/user-schema.json",
      "validData": [
        {
          "valid": true,
          "errors": [],
          "dataName": "user-valid-1.json"
        }
      ],
      "invalidData": [
        {
          "valid": false,
          "errors": [
            {
              "instancePath": "",
              "schemaPath": "#/required",
              "keyword": "required",
              "params": {"missingProperty": "email"},
              "message": "must have required property 'email'"
            }
          ],
          "dataName": "user-invalid-missing-required.json"
        }
      ],
      "summary": {
        "totalValid": 3,
        "totalInvalid": 4,
        "expectedValid": 3,
        "expectedInvalid": 4,
        "correctValidations": 7,
        "incorrectValidations": 0
      }
    }
  ]
}
```

## Adding New Test Cases

1. Add your JSON schema to `test-fixtures/schemas/`
2. Add valid test data to `test-fixtures/data/valid/`
3. Add invalid test data to `test-fixtures/data/invalid/`
4. Update `test-fixtures/batch-config.json` to include your new test case
5. Run the validator to verify everything works

## Integration with Melos

The JSON Schema validation tool is integrated into the Melos workflow with `validate-jsonschema` scripts.

See the main project's `melos.yaml` for all available commands.
