name: ack_workspace
repository: https://github.com/leoafarias/ack

packages:
  - packages/**
  - example/*

command:
  version:
    # Generate changelogs
    workspaceChangelog: true
    # Message for version commits
    message: "chore(release): publish packages"

scripts:
  analyze:
    run: melos exec -- "dart analyze . --fatal-infos"
    description: Run analyzer on all packages
    packageFilters:
      scope:
        - ack
        - ack_generator

  fix:
    run: melos exec -- "dart fix --apply"
    description: Apply fixes to all packages
    packageFilters:
      scope:
        - ack
        - ack_generator
      dependsOn:
        - "ack"  # This will ensure 'ack' is prioritized

  test:
    run: melos exec -- "dart test"
    description: Run tests for all packages
    packageFilters:
      dirExists: test

  format:
    run: melos exec -- "dart format . --fix"
    description: Format code for all packages

  deps-outdated:
    run: melos exec -- "dart pub outdated"
    description: Check for outdated dependencies in all packages

  # Create proper analysis_options.yaml files
  ensure_analysis_options:
    run: .scripts/ensure_analysis_options.sh
    description: Ensures each package has DCM configuration in analysis_options.yaml

  # Additional standard Melos commands
  bs:
    run: melos bootstrap
    description: Initialize the workspace with dependencies.

  clean:
    run: melos clean
    description: Clean all build outputs.

  # Build scripts for code generation
  build:
    run: melos exec -- "dart run build_runner build --delete-conflicting-outputs"
    description: Run build_runner for all packages
    packageFilters:
      dependsOn: build_runner

  # Version and publish scripts
  version-patch:
    run: melos version --patch --yes
    description: Bump patch version for all packages

  version-minor:
    run: melos version --minor --yes
    description: Bump minor version for all packages

  version-major:
    run: melos version --major --yes
    description: Bump major version for all packages

  publish-dry:
    run: melos publish
    description: Dry-run publish packages to pub.dev

  publish:
    run: melos publish --no-dry-run
    description: Publish packages to pub.dev
